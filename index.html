<!DOCTYPE html>
<html>
<head>
    <title>Toshokan</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin=""/>
    
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
      crossorigin=""></script>
      
    <style>
        /* ... Önceki CSS kodları (body, #map, .custom-popup) ... */
        body {
            padding: 0;
            margin: 0;
        }
        
        #map { 
            height: 100vh; 
            width: 100%; 
            background-color: #333;
        }

        /* --- POPUP CSS --- */
        .custom-popup .leaflet-popup-content-wrapper {
            background: #f9f9f9;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        .custom-popup .leaflet-popup-content {
            margin: 15px;
            width: 250px;
        }
        .custom-popup h3 {
            margin-top: 0;
            margin-bottom: 10px;
            color: #333;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
        .custom-popup p {
            margin: 5px 0 10px 0;
            color: #555;
            font-size: 14px;
            line-height: 1.4;
        }
        .custom-popup img {
            width: 100%;
            height: auto;
            border-radius: 4px;
            margin-top: 5px;
        }

        /* --- TOSHOKAN TARİHİ BUTON KONTEYNERİ (ALT ORTA) --- */
        #button-container {
            position: absolute;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            background: rgba(255, 255, 255, 0.8);
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            
            /* Başlangıçta gizli */
            display: none; 
        }

        #button-container button {
            background: #fff;
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
            margin: 0 3px;
            min-width: 30px; /* Ok butonları için */
        }
        #button-container button:hover {
            background: #f4f4f4;
        }
        #button-container button:active {
            background: #eee;
        }
        
        /* --- HARİTA BİLGİ KUTUSU (SAĞ ALT) --- */
        #map-info {
            position: absolute;
            bottom: 150px;
            right: 10px; 
            z-index: 1000;
            background: rgba(255, 255, 255, 0.85); 
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            max-width: 300px;
            font-family: sans-serif;
            line-height: 1.4;
            
            /* Başlangıçta gizli */
            display: none; 
        }

        #map-info h4 {
            margin-top: 0;
            margin-bottom: 5px;
            color: #333;
            font-size: 16px;
        }
        
        #map-info p {
            margin: 0;
            color: #555;
            font-size: 14px;
        }
        
        /* --- YENİ: SOL KONTROL PANELİ (HARİTA MODLARI) --- */
        #left-panel {
            position: absolute;
            top: 80px; 
            left: 10px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.85);
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            font-family: sans-serif;
        }
        #left-panel h4 {
            margin-top: 0;
            margin-bottom: 10px;
        }
        #left-panel label {
            display: block;
            margin-bottom: 5px;
            cursor: pointer;
        }
        
        /* Sağdaki katman kontrol panelini sola yanaştırıyoruz */
        .leaflet-top.leaflet-right {
            top: 170px; /* Sol panelin yüksekliğine göre ayarlayabilirsiniz */
        }
        
    </style>
</head>
<body>

<div id="map"></div>

<div id="left-panel">
    <h4>Harita Modu</h4>
    <label>
        <input type="radio" name="map-mode" value="kıta" checked> Kıta haritası
    </label>
    <label>
        <input type="radio" name="map-mode" value="tarih"> Toshokan tarihi
    </label>
    <label>
        <input type="radio" name="map-mode" value="aftzaak"> Aftzaak
    </label>
</div>

<div id="map-info">
    <h4 id="info-title">Harita Açıklaması</h4>
    <p id="info-text">Aktif harita ile ilgili açıklamalar burada görüntülenecektir.</p>
</div>

<div id="button-container">
    <button id="btn-prev">←</button>
    <button data-map-index="1" id="btn-map-1">1</button>
    <button data-map-index="2" id="btn-map-2">2</button>
    <button data-map-index="3" id="btn-map-3">3</button>
    <button data-map-index="4" id="btn-map-4">4</button>
    <button id="btn-next">→</button>
</div>


<script>
    // --- HARİTA GÖRSELLERİ VE BİLGİLERİ ---
    
    // Ayrı harita boyutları tanımlandı
    var kıtaWidth = 2048;
    var kıtaHeight = 2048;
    var kıtaBounds = [[0, 0], [kıtaHeight, kıtaWidth]]; // [[0, 0], [2048, 2048]]

    var aftzaakWidth = 1696;
    var aftzaakHeight = 2048;
    var aftzaakBounds = [[0, 0], [aftzaakHeight, aftzaakWidth]]; // [[0, 0], [2048, 1696]]


    var map = L.map('map', {
        crs: L.CRS.Simple,
        minZoom: -2,
        maxBounds: kıtaBounds, // Varsayılan olarak kıta sınırları
        maxBoundsViscosity: 1.0
    });

    // 0: Kıta, 1-4: Toshokan Tarihi
    var mapImages = [
        'resimler/Harita.png',     // index 0
        'resimler/THarita1.png', // index 1
        'resimler/THarita2.png', // index 2
        'resimler/THarita3.png', // index 3
        'resimler/THarita4.png'  // index 4
    ];
    
    // Aftzaak haritası için ayrı bir katman
    var aftzaakMapLayer = L.imageOverlay('resimler/KSehri.png', aftzaakBounds);

    var mapDescriptions = [
        "Standart coğrafya haritası. Bu, dünyanın günümüzdeki genel görünümüdür.", // Harita 0
        "Hikâyenin geçtiği yer, dumanlar içindeki bu dünyadır. Büyüklüğü Almanya kadardır.", // Harita 1
        "Şu anda tamamen dumanın altında kalmış durumdadır.", // Harita 2
        "Hikâyenin geçtiği yerin batısında, büyük kulak memelerine sahip bir halk olan Tana kabilesinin (Tana soyunun) yurdu bulunur. Burada kıtanın altın çağını kurmuşlardır.", // Harita 3
        "Görkemli (en parlak) dönemlerindeki toprakları / en geniş sınırları." // Harita 4
    ];
    
    var mapTitles = [
        "Ana Harita",
        "Toshokan Medeniyetleri (1)",
        "Toshokan Medeniyetleri (2)",
        "Toshokan Medeniyetleri (3)",
        "Toshokan Medeniyetleri (4)"
    ];
    
    var mapLayers = [];
    var currentActiveMap = null;
    var currentTarihIndex = 1; // Toshokan Tarihi haritaları 1-4 arası
    
    // Aktif katman kontrol panelini (sağ panel) tutmak için değişken
    var currentLayerControl = null;

    var mapInfoContainer = document.getElementById('map-info');
    var infoTitle = document.getElementById('info-title');
    var infoText = document.getElementById('info-text');
    var buttonContainer = document.getElementById('button-container');


    // --- TÜM HARİTALARI ARKA PLANDA OLUŞTUR ---
    mapImages.forEach((url, index) => {
        // Kıta ve Tarih haritaları 'kıtaBounds' kullanır
        var layer = L.imageOverlay(url, kıtaBounds);
        mapLayers.push(layer);
        
        if (index === 0) {
            // Başlangıçta Ana Harita'yı (index 0) ekle
            layer.addTo(map);
            currentActiveMap = layer;
        } 
    });

    // Başlangıç view'ı kıta boyutlarına göre ayarlandı
    map.setView([kıtaHeight / 2, kıtaWidth / 2], -1.25);

    var Isaret = L.icon({
        iconUrl: 'resimler/Isaret2.png',
        iconSize: [48, 48],
        iconAnchor: [24, 48],
        popupAnchor: [0, -32]
    });

    // --- KATMAN 1: KITA HARİTASI KONUMLARI ---
    var centerContent = "<h3>HYDİAH TOPRAKLARI</h3><p>Hydiah ırkından Istayu halkının yuvası olan bu bölge... <a href='...'>Devamı</a></p><img src='resimler/Hydiah.png' alt='...'>";
    var centerMarker = L.marker([1365, 458], {icon: Isaret}).bindPopup(centerContent, { className: 'custom-popup' });
    var kaleContent = "<h3>Sissiz Alan</h3><p>Acıpelin Gizmeni felaketi sonrası geriye kalan yaşanabilir bölge, boyutu günümüz Almanyası kadardır.</p><img src='resimler/SAHarita.png' alt='...'>"; 
    var northWestLocation = L.marker([1098, 659], {icon: Isaret}).bindPopup( kaleContent, { className: 'custom-popup' });
    var lobinContent = "<h3>LOBİN BÖLGESİ</h3><p>İnsanın atası olan Lobino kemir-genine ev sahipliği yapar. Tektonik... <a href='...'>Devamı</a></p><img src='resimler/Lobin.png' alt='Lobino Kemirgeni'>";
    var lobinLocation = L.marker([1558, 1650], {icon: Isaret}).bindPopup(lobinContent, { className: 'custom-popup' }); 
    var yoktContent = "<h3>SIRAKADİ BÖLGESİ</h3><p>Syrrana Savaşı'ndan geride kalmış bir savaş alanının kalıntıla- <a href='...'>Devamı</a></p><img src='resimler/Yokt.png' alt='Syrrana Savaşı Alanı'>";
    var yoktLocation = L.marker([1198, 1019], {icon: Isaret}).bindPopup(yoktContent, { className: 'custom-popup' }); 
    var karasinaekContent = "<h3>KARASİNAEK BÖLGESİ</h3><p>Sivri kulaklı Haupi halkının yuvası olan bu bölge... <a href='...'>Devamı</a></p><img src='resimler/Kansinaek.png' alt='Karasinaek Bölgesi'>";
    var karasinaekLocation = L.marker([791, 1077], {icon: Isaret}).bindPopup(karasinaekContent, { className: 'custom-popup' });
    
    var locationsLayer = L.layerGroup([centerMarker, northWestLocation, lobinLocation, yoktLocation, karasinaekLocation]);

    // --- KATMAN 2: SİS KATMANI (KITA HARİTASI İÇİN) ---
    var sisUrl = 'resimler/Bulutlar.png';
    var sisBounds = [[0, 0], [kıtaHeight, kıtaWidth]]; // Bu da kıta boyutlarında
    var sisLayer = L.imageOverlay(sisUrl, sisBounds, { opacity: 0.8, interactive: false });
    
    // --- KATMAN 3: AFTZAAK KONUMLARI ---
    
    // *** DÜZELTME: Marker 1 (Saray) (PS Y: 1527 -> Leaflet Y: 2048 - 1527 = 521) ***
    var aftzaakContent1 = "<h3>Aftzaanka Sarayı</h3><p>Aftzaak'ın mevcut hükümdarları olan... <a href='#'>Devamı</a></p><img src='resimler/Aftzaanka.png' alt='Aftzaanka Sarayı'>";
    var aftzaakMarker1 = L.marker([521, 1405], {icon: Isaret}).bindPopup(aftzaakContent1, { className: 'custom-popup' });
    
    // *** DÜZELTME: Marker 2 (Enstitü) (PS Y: 1352 -> Leaflet Y: 2048 - 1352 = 696) ***
    var aftzaakContent2 = "<h3>TOHNE ENSTİTÜSÜ İKİNCİ KAMPÜSÜ</h3><p>Şehirdeki en seçkin alimlerin görev yaptığı... <a href='#'>Devamı</a></p><img src='resimler/Tohne.png' alt='Tohne Enstitüsü'>";
    var aftzaakMarker2 = L.marker([696, 299], {icon: Isaret}).bindPopup(aftzaakContent2, { className: 'custom-popup' });
    
    var aftzaakLocationsLayer = L.layerGroup([aftzaakMarker1, aftzaakMarker2]);


    // --- FONKSİYONLAR ---

    // ANA HARİTA DEĞİŞTİRME FONKSİYONU
    function switchMap(index) {
        var newLayer = mapLayers[index];
        
        if (newLayer === currentActiveMap) {
            return;
        }
        
        // Önceki aktif katman ne olursa olsun (Kıta, Tarih, Aftzaak) kaldır
        if (currentActiveMap) {
            map.removeLayer(currentActiveMap);
        }
        
        newLayer.addTo(map);
        currentActiveMap = newLayer;

        // Harita sınırlarını ve merkezini Kıta/Tarih için ayarla
        map.setMaxBounds(kıtaBounds);
        // Sadece ana kıta haritasına (index 0) dönerken merkezi sıfırla
        if (index === 0) {
            map.setView([kıtaHeight / 2, kıtaWidth / 2], -1.25);
        }
        
        // Sadece Toshokan Tarihi haritaları (index 1-4) için bilgi kutusunu güncelle
        if (index > 0) {
            infoTitle.textContent = mapTitles[index];
            infoText.textContent = mapDescriptions[index];
            currentTarihIndex = index; // İndeksi de güncelle
        }
    }
    
    // AFTZAAK HARİTASINA GEÇİŞ FONKSİYONU
    function switchToAftzaak() {
        if (currentActiveMap === aftzaakMapLayer) {
            return;
        }
        
        // Önceki aktif katmanı (Kıta veya Tarih) kaldır
        if (currentActiveMap) {
            map.removeLayer(currentActiveMap);
        }
        
        aftzaakMapLayer.addTo(map);
        currentActiveMap = aftzaakMapLayer;

        // Harita sınırlarını ve merkezini Aftzaak için ayarla
        map.setMaxBounds(aftzaakBounds);
        map.setView([aftzaakHeight / 2, aftzaakWidth / 2], -1.25);
    }
    
    // Tüm overlay katmanlarını temizle
    function clearAllOverlays() {
        map.removeLayer(locationsLayer);
        map.removeLayer(sisLayer);
        map.removeLayer(aftzaakLocationsLayer);
    }

    // Harita moduna göre sağdaki katman panelini güncelleyen fonksiyon
    function updateLayerControl(mode) {
        // 1. Varsa, mevcut katman kontrol panelini kaldır
        if (currentLayerControl) {
            map.removeControl(currentLayerControl);
            currentLayerControl = null;
        }

        // 2. Yeni moda göre yeni bir panel oluştur
        if (mode === 'kıta') {
            var kıtaOverlays = {
                "Konumlar": locationsLayer,
                "Sisi Göster": sisLayer
            };
            currentLayerControl = L.control.layers(null, kıtaOverlays, { collapsed: false }).addTo(map);
            
        } else if (mode === 'aftzaak') {
            var aftzaakOverlays = {
                "Konumlar": aftzaakLocationsLayer
            };
            currentLayerControl = L.control.layers(null, aftzaakOverlays, { collapsed: false }).addTo(map);
        }
        // 'tarih' modundaysa, hiçbir panel oluşturulmaz (currentLayerControl = null olarak kalır)
    }


    // --- OLAY DİNLEYİCİLERİ (EVENT LISTENERS) ---

    // 1. SOL PANEL (HARİTA MODU) DİNLEYİCİSİ
    document.getElementById('left-panel').addEventListener('change', function(e) {
        if (e.target.name === 'map-mode') {
            
            clearAllOverlays(); // Önce tüm konum/sis katmanlarını haritadan temizle
            
            var newMode = e.target.value;
            
            // Mod ne olursa olsun, önce sağ paneli güncelle
            updateLayerControl(newMode);
            
            switch (newMode) {
                case 'kıta':
                    switchMap(0); // Ana Harita'ya (index 0) geç
                    
                    // Arayüzü ayarla
                    buttonContainer.style.display = 'none';
                    mapInfoContainer.style.display = 'none';
                    
                    // Kıta konumlarını varsayılan olarak ekle
                    locationsLayer.addTo(map);
                    break;
                    
                case 'tarih':
                    switchMap(1); // İlk Toshokan Tarihi haritasına (index 1) geç
                    
                    // Arayüzü ayarla
                    buttonContainer.style.display = 'block';
                    mapInfoContainer.style.display = 'block';
                    break;
                    
                case 'aftzaak':
                    switchToAftzaak(); // Aftzaak haritasına geç
                    
                    // Arayüzü ayarla
                    buttonContainer.style.display = 'none';
                    mapInfoContainer.style.display = 'none';
                    
                    // Aftzaak konumlarını varsayılan olarak ekle
                    aftzaakLocationsLayer.addTo(map);
                    break;
            }
        }
    });

    // 2. ALT BUTON (TOSHOKAN TARİHİ) DİNLEYİCİSİ
    buttonContainer.addEventListener('click', function(e) {
        var target = e.target;
        
        // 1, 2, 3, 4 butonları
        if (target.tagName === 'BUTTON' && target.dataset.mapIndex) {
            var index = parseInt(target.dataset.mapIndex, 10);
            switchMap(index);
        }
        
        // Önceki (←) butonu
        if (target.id === 'btn-prev') {
            var newIndex = currentTarihIndex - 1;
            if (newIndex < 1) {
                newIndex = 4; // 1'den 4'e döngü yap
            }
            switchMap(newIndex);
        }
        
        // Sonraki (→) butonu
        if (target.id === 'btn-next') {
            var newIndex = currentTarihIndex + 1;
            if (newIndex > 4) {
                newIndex = 1; // 4'ten 1'e döngü yap
            }
            switchMap(newIndex);
        }
    });
    
    
    // --- BAŞLANGIÇ AYARLARI ---
    // Sayfa yüklendiğinde varsayılan (Kıta) durumunu ayarla
    function initializeMapState() {
        // Başlangıçta 'kıta' modu için sağ paneli oluştur
        updateLayerControl('kıta');
        
        // Başlangıç katmanını haritaya ekle
        locationsLayer.addTo(map);
        
        // Diğer paneller gizli olsun
        buttonContainer.style.display = 'none';
        mapInfoContainer.style.display = 'none';
    }
    
    initializeMapState();

</script>

</body>
</html>
