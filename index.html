<!DOCTYPE html>
<html>
<head>
    <title>Fantezi Dünya Haritam</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
     crossorigin=""/>
    
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>
     
    <style>
        /* ... Önceki CSS kodları (body, #map, .custom-popup, #button-container) buraya KOPYALANACAK ... */

        body {
            padding: 0;
            margin: 0;
        }
        
        #map { 
            height: 100vh;
            width: 100%; 
            background-color: #333;
        }

        /* --- POPUP CSS --- */
        .custom-popup .leaflet-popup-content-wrapper {
            background: #f9f9f9;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        .custom-popup .leaflet-popup-content {
            margin: 15px;
            width: 250px;
        }
        .custom-popup h3 {
            margin-top: 0;
            margin-bottom: 10px;
            color: #333;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
        .custom-popup p {
            margin: 5px 0 10px 0;
            color: #555;
            font-size: 14px;
            line-height: 1.4;
        }
        .custom-popup img {
            width: 100%;
            height: auto;
            border-radius: 4px;
            margin-top: 5px;
        }

        /* --- BUTON KONTEYNERİ CSS'İ --- */
        #button-container {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            background: rgba(255, 255, 255, 0.8);
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            
            /* Başlangıçta gizli */
            display: none; 
        }

        #button-container button {
            background: #fff;
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
            margin: 0 3px;
        }
        #button-container button:hover {
            background: #f4f4f4;
        }
        #button-container button:active {
            background: #eee;
        }

    </style>
</head>
<body>

<div id="map"></div>

<div id="button-container">
    <button data-map-index="0" id="btn-map-0">Ana Harita</button>
    <button data-map-index="1" id="btn-map-1">T. Harita 1</button>
    <button data-map-index="2" id="btn-map-2">T. Harita 2</button>
    <button data-map-index="3" id="btn-map-3">T. Harita 3</button>
    <button data-map-index="4" id="btn-map-4">T. Harita 4</button>
</div>


<script>
    var w = 2048;
    var h = 2048;
    var bounds = [[0, 0], [h, w]];

    var map = L.map('map', {
        crs: L.CRS.Simple,
        minZoom: -2,
        maxBounds: bounds,
        maxBoundsViscosity: 1.0
    });

    // Harita resimlerinin listesi
    var mapImages = [
        'resimler/Harita.png',   // index 0
        'resimler/THarita1.png', // index 1
        'resimler/THarita2.png', // index 2
        'resimler/THarita3.png', // index 3
        'resimler/THarita4.png'  // index 4
    ];
    
    // YENİ: Harita katmanlarını tutacak dizi ve o anki aktif harita
    var mapLayers = [];
    var currentActiveMap = null;

    // --- TÜM HARİTALARI ARKA PLANDA OLUŞTUR VE İNDİR ---
    mapImages.forEach((url, index) => {
        // Her harita için bir L.imageOverlay oluştur
        var layer = L.imageOverlay(url, bounds);
        
        // Bu katmanı diziye ekle
        mapLayers.push(layer);
        
        // İlk haritayı (index 0) haritaya ekleyerek görünür yap
        if (index === 0) {
            layer.addTo(map);
            currentActiveMap = layer;
        } 
        // DİĞER HARİTALAR HARİTAYA EKLENMEZ, SADECE ARKA PLANDA TUTULUR.
        // Tarayıcı bu noktada tüm resimleri indirmeye başlar (ön yükleme).
    });

    map.setView([h / 2, w / 2], -1.25);

    var Isaret = L.icon({
        iconUrl: 'resimler/Isaret2.png',
        iconSize: [48, 48],
        iconAnchor: [24, 48],
        popupAnchor: [0, -32]
    });

    // --- POPUP İÇERİKLERİ VE KONUMLAR (DEĞİŞMEDİ) ---
    var centerContent = "<h3>HYDİAH TOPRAKLARI</h3><p>Hydiah ırkından Istayu halkının yuvası olan bu bölge... <a href='...'>Devamı</a></p><img src='resimler/Hydiah.png' alt='...'>";
    var centerMarker = L.marker([1365, 458], {icon: Isaret}).bindPopup(centerContent, { className: 'custom-popup' });
    var kaleContent = "<h3>Sissiz Alan</h3><p>Acıpelin Gizmeni felaketi sonrası geriye kalan yaşanabilir bölge, boyutu günümüz Almanyası kadardır.</p><img src='resimler/SAHarita.png' alt='...'>"; 
    var northWestLocation = L.marker([1098, 659], {icon: Isaret}).bindPopup(kaleContent, { className: 'custom-popup' });
    
    var sisUrl = 'resimler/Bulutlar.png';
    var sisBounds = [[0, 0], [h, w]]; 
    var sisLayer = L.imageOverlay(sisUrl, sisBounds, { opacity: 0.8, interactive: false });
    var locationsLayer = L.layerGroup([centerMarker, northWestLocation]);

    // "Toshokan Medeniyetleri" için boş bir katman
    var toshokanLayer = L.layerGroup();

    var overlayMaps = {
        "Konumlar": locationsLayer,
        "Sisi Göster": sisLayer,
        "Toshokan Medeniyetleri": toshokanLayer
    };

    var control = L.control.layers(null, overlayMaps, { collapsed: false }).addTo(map);
    locationsLayer.addTo(map);
    
    
    // --- BUTON VE KONTROL MANTIĞI ---

    var buttonContainer = document.getElementById('button-container');
    var controlContainer = control.getContainer();
    var inputs = controlContainer.getElementsByTagName('input');
    
    var konumlarInput = inputs[0]; 
    var sisInput = inputs[1];      

    // YENİ HARİTA DEĞİŞTİRME FONKSİYONU (ANLIK ÇALIŞIR)
    function switchMap(index) {
        var newLayer = mapLayers[index];
        
        // Eğer zaten aktifse bir şey yapma
        if (newLayer === currentActiveMap) {
            return;
        }
        
        // Önceki aktif haritayı haritadan kaldır (EĞER VARSA)
        if (currentActiveMap) {
            map.removeLayer(currentActiveMap);
        }
        
        // Yeni haritayı ekle (bu anlık olacaktır, çünkü dosya zaten indirilmiştir)
        newLayer.addTo(map);
        currentActiveMap = newLayer;
    }

    // Butonlara tek bir olay dinleyicisi ekleyerek işi basitleştir
    buttonContainer.addEventListener('click', function(e) {
        if (e.target.tagName === 'BUTTON') {
            var index = parseInt(e.target.dataset.mapIndex, 10);
            switchMap(index);
        }
    });


    // Haritaya bir katman EKLENDİĞİNDE tetiklenir
    map.on('overlayadd', function(e) {
        if (e.layer === toshokanLayer) {
            buttonContainer.style.display = 'block';
            
            // Diğer katmanları haritadan kaldır ve tikleri kaldır (Düzeltme yapılmıştı)
            map.removeLayer(locationsLayer);
            map.removeLayer(sisLayer);
            konumlarInput.checked = false;
            sisInput.checked = false;
            
            // Seçenekleri devre dışı bırak
            konumlarInput.disabled = true;
            sisInput.disabled = true;
        }
    });

    // Haritadan bir katman KALDIRILDIĞINDA tetiklenir
    map.on('overlayremove', function(e) {
        if (e.layer === toshokanLayer) {
            buttonContainer.style.display = 'none';
            konumlarInput.disabled = false;
            sisInput.disabled = false;
            
            // Orijinal haritaya geri dön
            switchMap(0);
        }
    });

</script>

</body>
</html>
